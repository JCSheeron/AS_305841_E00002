define(["require", "exports", "../../common/packageConversion/enum/objectTypeEnum", "../../common/persistence/settings", "../../common/packageConversion/enum/additionalMetaKeys", "../../common/packageConversion/enum/dataTypeEnum", "../../common/packageConversion/mceConversionError", "./signalManagerDataModelSettingIds", "../../common/packageConversion/meta", "../../common/packageConversion/enum/arrayTypeEnum", "../../common/packageConversion/package"], function (require, exports, objectTypeEnum_1, settings_1, additionalMetaKeys_1, dataTypeEnum_1, mceConversionError_1, signalManagerDataModelSettingIds_1, meta_1, arrayTypeEnum_1, package_1) {
    "use strict";
    Object.defineProperty(exports, "__esModule", { value: true });
    var DataIds;
    (function (DataIds) {
        DataIds["ContainerName"] = "containerName";
        DataIds["SerieGroupStartTriggerTime"] = "startTriggerTime";
        DataIds["SeriesIds"] = "seriesIds";
    })(DataIds || (DataIds = {}));
    var SerieGroupPackageAdapter = /** @class */ (function () {
        function SerieGroupPackageAdapter() {
            //newest version of package format
            this.currentPackageVersion = 1;
            this.settingsType = "SerieGroup";
            this.objectType = objectTypeEnum_1.ObjectType.SERIEGROUP;
        }
        SerieGroupPackageAdapter.prototype.packageToSetting = function (packageData, container) {
            var _a, _b, _c;
            var setting = new settings_1.Settings(this.settingsType);
            if (((_a = packageData === null || packageData === void 0 ? void 0 : packageData.meta) === null || _a === void 0 ? void 0 : _a.dataType) == dataTypeEnum_1.DataType.OBJECT && ((_b = packageData === null || packageData === void 0 ? void 0 : packageData.meta) === null || _b === void 0 ? void 0 : _b[additionalMetaKeys_1.AdditionalMetaKeys.OBJECTTYPE]) == this.objectType) {
                switch ((_c = packageData === null || packageData === void 0 ? void 0 : packageData.meta) === null || _c === void 0 ? void 0 : _c[additionalMetaKeys_1.AdditionalMetaKeys.VERSION]) {
                    case 1:
                        setting = this.packageV1ToSetting(packageData, container);
                        break;
                    default:
                        throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.UNSUPPORTED_VERSION, this.objectType);
                }
            }
            else {
                throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.UNSUPPORTED_TYPE, this.objectType);
            }
            return setting;
        };
        SerieGroupPackageAdapter.prototype.packageV1ToSetting = function (packageData, container) {
            var _a, _b, _c, _d, _e, _f, _g, _h, _j, _k, _l, _m, _o, _p, _q, _r, _s, _t;
            var setting = new settings_1.Settings(this.settingsType);
            if (((_c = (_b = (_a = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _a === void 0 ? void 0 : _a[DataIds.ContainerName]) === null || _b === void 0 ? void 0 : _b.meta) === null || _c === void 0 ? void 0 : _c.dataType) === dataTypeEnum_1.DataType.STRING) {
                setting.setValue(signalManagerDataModelSettingIds_1.SettingIds.ContainerName, (_e = (_d = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _d === void 0 ? void 0 : _d[DataIds.ContainerName]) === null || _e === void 0 ? void 0 : _e.data);
            }
            if (((_h = (_g = (_f = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _f === void 0 ? void 0 : _f[DataIds.SerieGroupStartTriggerTime]) === null || _g === void 0 ? void 0 : _g.meta) === null || _h === void 0 ? void 0 : _h.dataType) === dataTypeEnum_1.DataType.NUMBER) {
                setting.setValue(signalManagerDataModelSettingIds_1.SettingIds.SerieGroupStartTriggerTime, (_k = (_j = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _j === void 0 ? void 0 : _j[DataIds.SerieGroupStartTriggerTime]) === null || _k === void 0 ? void 0 : _k.data);
            }
            else {
                throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, DataIds.SerieGroupStartTriggerTime);
            }
            if (((_o = (_m = (_l = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _l === void 0 ? void 0 : _l[DataIds.SeriesIds]) === null || _m === void 0 ? void 0 : _m.meta) === null || _o === void 0 ? void 0 : _o.dataType) === dataTypeEnum_1.DataType.ARRAY && ((_r = (_q = (_p = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _p === void 0 ? void 0 : _p[DataIds.SeriesIds]) === null || _q === void 0 ? void 0 : _q.meta) === null || _r === void 0 ? void 0 : _r[additionalMetaKeys_1.AdditionalMetaKeys.ARRAYTYPE]) === arrayTypeEnum_1.ArrayType.STRING) {
                setting.setValue(signalManagerDataModelSettingIds_1.SettingIds.SeriesIds, (_t = (_s = packageData === null || packageData === void 0 ? void 0 : packageData.data) === null || _s === void 0 ? void 0 : _s[DataIds.SeriesIds]) === null || _t === void 0 ? void 0 : _t.data);
            }
            else {
                throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, DataIds.SeriesIds);
            }
            return setting;
        };
        SerieGroupPackageAdapter.prototype.settingToPackage = function (settingsData) {
            var settings = settings_1.Settings.create(settingsData);
            var serieGroupData = {};
            var packageStructure = {
                packages: new Array(),
                topLevelID: NaN
            };
            if (settings.type === this.settingsType) {
                var id = meta_1.Meta.createID();
                var additionalMetaInfo = [{ key: additionalMetaKeys_1.AdditionalMetaKeys.OBJECTTYPE, value: this.objectType }, { key: additionalMetaKeys_1.AdditionalMetaKeys.ID, value: id }, { key: additionalMetaKeys_1.AdditionalMetaKeys.VERSION, value: this.currentPackageVersion }];
                var seriesGroupMeta = new meta_1.Meta(dataTypeEnum_1.DataType.OBJECT, additionalMetaInfo);
                var containerNameData = settings.getValue(signalManagerDataModelSettingIds_1.SettingIds.ContainerName);
                if (containerNameData !== undefined) {
                    serieGroupData[DataIds.ContainerName] = new package_1.Package(new meta_1.Meta(dataTypeEnum_1.DataType.STRING), containerNameData);
                }
                var serieGroupStartTriggerTimeData = settings.getValue(signalManagerDataModelSettingIds_1.SettingIds.SerieGroupStartTriggerTime);
                if (serieGroupStartTriggerTimeData !== undefined) {
                    serieGroupData[DataIds.SerieGroupStartTriggerTime] = new package_1.Package(new meta_1.Meta(dataTypeEnum_1.DataType.NUMBER), serieGroupStartTriggerTimeData);
                }
                else {
                    throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, signalManagerDataModelSettingIds_1.SettingIds.SerieGroupStartTriggerTime);
                }
                var serieIdsData = settings.getValue(signalManagerDataModelSettingIds_1.SettingIds.SeriesIds);
                if (serieIdsData !== undefined) {
                    var serieIdsMeta = new meta_1.Meta(dataTypeEnum_1.DataType.ARRAY, [{ key: additionalMetaKeys_1.AdditionalMetaKeys.ARRAYTYPE, value: arrayTypeEnum_1.ArrayType.STRING }]);
                    serieGroupData[DataIds.SeriesIds] = new package_1.Package(serieIdsMeta, serieIdsData);
                }
                else {
                    throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.MISSING_DATA, signalManagerDataModelSettingIds_1.SettingIds.SeriesIds);
                }
                var seriesGroupPackage = new package_1.Package(seriesGroupMeta, serieGroupData);
                packageStructure.packages.push(seriesGroupPackage);
                packageStructure.topLevelID = id;
            }
            else {
                throw mceConversionError_1.MceConversionError.createErrorByType(mceConversionError_1.MceConversionErrorType.UNSUPPORTED_VERSION, this.settingsType);
            }
            return packageStructure;
        };
        return SerieGroupPackageAdapter;
    }());
    exports.SerieGroupPackageAdapter = SerieGroupPackageAdapter;
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic2VyaWVHcm91cFBhY2thZ2VBZGFwdGVyLmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vc3JjL2FwcC9tb2RlbHMvc2lnbmFsTWFuYWdlckRhdGFNb2RlbC9zZXJpZUdyb3VwUGFja2FnZUFkYXB0ZXIudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7O0lBZUEsSUFBSyxPQUlKO0lBSkQsV0FBSyxPQUFPO1FBQ1IsMENBQStCLENBQUE7UUFDL0IsMERBQStDLENBQUE7UUFDL0Msa0NBQXVCLENBQUE7SUFDM0IsQ0FBQyxFQUpJLE9BQU8sS0FBUCxPQUFPLFFBSVg7SUFFRDtRQVFJO1lBTkEsa0NBQWtDO1lBQ2pCLDBCQUFxQixHQUFXLENBQUMsQ0FBQztZQU0vQyxJQUFJLENBQUMsWUFBWSxHQUFHLFlBQVksQ0FBQztZQUNqQyxJQUFJLENBQUMsVUFBVSxHQUFHLDJCQUFVLENBQUMsVUFBVSxDQUFDO1FBQzVDLENBQUM7UUFFRCxtREFBZ0IsR0FBaEIsVUFBaUIsV0FBcUIsRUFBRSxTQUEwQjs7WUFFOUQsSUFBSSxPQUFPLEdBQWMsSUFBSSxtQkFBUSxDQUFDLElBQUksQ0FBQyxZQUFZLENBQUMsQ0FBQztZQUV6RCxJQUFHLE9BQUEsV0FBVyxhQUFYLFdBQVcsdUJBQVgsV0FBVyxDQUFFLElBQUksMENBQUUsUUFBUSxLQUFJLHVCQUFRLENBQUMsTUFBTSxJQUFJLE9BQUEsV0FBVyxhQUFYLFdBQVcsdUJBQVgsV0FBVyxDQUFFLElBQUksMENBQUcsdUNBQWtCLENBQUMsVUFBVSxNQUFLLElBQUksQ0FBQyxVQUFVLEVBQUU7Z0JBRXhILGNBQU8sV0FBVyxhQUFYLFdBQVcsdUJBQVgsV0FBVyxDQUFFLElBQUksMENBQUcsdUNBQWtCLENBQUMsT0FBTyxHQUFFO29CQUNuRCxLQUFLLENBQUM7d0JBQ0YsT0FBTyxHQUFHLElBQUksQ0FBQyxrQkFBa0IsQ0FBQyxXQUFXLEVBQUUsU0FBUyxDQUFDLENBQUM7d0JBQzFELE1BQU07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QUFZLEtBQUssU0FBUyxFQUFFO29CQUMzQixJQUFJLFlBQVksR0FBRyxJQUFJLFdBQUksQ0FBQyx1QkFBUSxDQUFDLEtBQUssRUFBRSxDQUFDLEVBQUMsR0FBRyxFQUFFLHVDQUFrQixDQUFDLFNBQVMsRUFBRSxLQUFLLEVBQUUseUJBQVMsQ0FBQyxNQUFNLEVBQUMsQ0FBQyxDQUFDLENBQUM7b0JBQzVHLGNBQWMsQ0FBQyxPQUFPLENBQUMsU0FBUyxDQUFDLEdBQUcsSUFBSSxpQkFBTyxDQUFDLFlBQVksRUFBRSxZQUFZLENBQUMsQ0FBQztpQkFDL0U7cUJBQU07b0JBQ0gsTUFBTSx1Q0FBa0IsQ0FBQyxpQkFBaUIsQ0FBQywyQ0FBc0IsQ0FBQyxZQUFZLEVBQUUsNkNBQVUsQ0FBQyxTQUFTLENBQUMsQ0FBQztpQkFDekc7Z0JBR0QsSUFBSSxrQkFBa0IsR0FBRyxJQUFJLGlCQUFPLENBQUMsZUFBZSxFQUFFLGNBQWMsQ0FBQyxDQUFDO2dCQUV0RSxnQkFBZ0IsQ0FBQyxRQUFRLENBQUMsSUFBSSxDQUFDLGtCQUFrQixDQUFDLENBQUM7Z0JBQ25ELGdCQUFnQixDQUFDLFVBQVUsR0FBRyxFQUFFLENBQUM7YUFDcEM7aUJBQUs7Z0JBQ0YsTUFBTSx1Q0FBa0IsQ0FBQyxpQkFBaUIsQ0FBQywyQ0FBc0IsQ0FBQyxtQkFBbUIsRUFBRSxJQUFJLENBQUMsWUFBWSxDQUFDLENBQUM7YUFDN0c7WUFFRCxPQUFPLGdCQUFnQixDQUFDO1FBQzVCLENBQUM7UUFDTCwrQkFBQztJQUFELENBQUMsQUF6R0QsSUF5R0M7SUFFUSw0REFBd0IiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgeyBJUGFja2FnZUFkYXB0ZXIsIFBhY2thZ2VBcnJheVdpdGhUb3BMZXZlbElEIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9wYWNrYWdlQ29udmVyc2lvbi9pbnRlcmZhY2UvcGFja2FnZUFkYXB0ZXJJbnRlcmZhY2VcIjtcclxuaW1wb3J0IHsgT2JqZWN0VHlwZSB9IGZyb20gXCIuLi8uLi9jb21tb24vcGFja2FnZUNvbnZlcnNpb24vZW51bS9vYmplY3RUeXBlRW51bVwiO1xyXG5pbXBvcnQgeyBJUGFja2FnZSB9IGZyb20gXCIuLi8uLi9jb21tb24vcGFja2FnZUNvbnZlcnNpb24vaW50ZXJmYWNlL3BhY2thZ2VJbnRlcmZhY2VcIjtcclxuaW1wb3J0IHsgRXhwb3J0Q29udGFpbmVyIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9wYWNrYWdlQ29udmVyc2lvbi9leHBvcnRDb250YWluZXJcIjtcclxuaW1wb3J0IHsgSVNldHRpbmdzIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9wZXJzaXN0ZW5jZS9pbnRlcmZhY2VzL3NldHRpbmdzSW50ZXJmYWNlXCI7XHJcbmltcG9ydCB7IFNldHRpbmdzIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9wZXJzaXN0ZW5jZS9zZXR0aW5nc1wiO1xyXG5pbXBvcnQgeyBBZGRpdGlvbmFsTWV0YUtleXMgfSBmcm9tIFwiLi4vLi4vY29tbW9uL3BhY2thZ2VDb252ZXJzaW9uL2VudW0vYWRkaXRpb25hbE1ldGFLZXlzXCI7XHJcbmltcG9ydCB7IERhdGFUeXBlIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9wYWNrYWdlQ29udmVyc2lvbi9lbnVtL2RhdGFUeXBlRW51bVwiO1xyXG5pbXBvcnQgeyBNY2VDb252ZXJzaW9uRXJyb3IsIE1jZUNvbnZlcnNpb25FcnJvclR5cGUgfSBmcm9tIFwiLi4vLi4vY29tbW9uL3BhY2thZ2VDb252ZXJzaW9uL21jZUNvbnZlcnNpb25FcnJvclwiO1xyXG5pbXBvcnQgeyBTZXR0aW5nSWRzIH0gZnJvbSBcIi4vc2lnbmFsTWFuYWdlckRhdGFNb2RlbFNldHRpbmdJZHNcIjtcclxuaW1wb3J0IHsgTWV0YSB9IGZyb20gXCIuLi8uLi9jb21tb24vcGFja2FnZUNvbnZlcnNpb24vbWV0YVwiO1xyXG5pbXBvcnQgeyBBcnJheVR5cGUgfSBmcm9tIFwiLi4vLi4vY29tbW9uL3BhY2thZ2VDb252ZXJzaW9uL2VudW0vYXJyYXlUeXBlRW51bVwiO1xyXG5pbXBvcnQgeyBQYWNrYWdlIH0gZnJvbSBcIi4uLy4uL2NvbW1vbi9wYWNrYWdlQ29udmVyc2lvbi9wYWNrYWdlXCI7XHJcblxyXG5cclxuZW51bSBEYXRhSWRzIHtcclxuICAgIENvbnRhaW5lck5hbWUgPSBcImNvbnRhaW5lck5hbWVcIixcclxuICAgIFNlcmllR3JvdXBTdGFydFRyaWdnZXJUaW1lID0gXCJzdGFydFRyaWdnZXJUaW1lXCIsXHJcbiAgICBTZXJpZXNJZHMgPSBcInNlcmllc0lkc1wiXHJcbn1cclxuXHJcbmNsYXNzIFNlcmllR3JvdXBQYWNrYWdlQWRhcHRlciBpbXBsZW1lbnRzIElQYWNrYWdlQWRhcHRlciB7XHJcbiAgICBcclxuICAgIC8vbmV3ZXN0IHZlcnNpb24gb2YgcGFja2FnZSBmb3JtYXRcclxuICAgIHByaXZhdGUgcmVhZG9ubHkgY3VycmVudFBhY2thZ2VWZXJzaW9uOiBudW1iZXIgPSAxO1xyXG5cclxuICAgIHByaXZhdGUgc2V0dGluZ3NUeXBlOiBzdHJpbmc7XHJcbiAgICBwcml2YXRlIG9iamVjdFR5cGU6IE9iamVjdFR5cGU7XHJcblxyXG4gICAgY29uc3RydWN0b3IoKSB7XHJcbiAgICAgICAgdGhpcy5zZXR0aW5nc1R5cGUgPSBcIlNlcmllR3JvdXBcIjtcclxuICAgICAgICB0aGlzLm9iamVjdFR5cGUgPSBPYmplY3RUeXBlLlNFUklFR1JPVVA7XHJcbiAgICB9XHJcblxyXG4gICAgcGFja2FnZVRvU2V0dGluZyhwYWNrYWdlRGF0YTogSVBhY2thZ2UsIGNvbnRhaW5lcjogRXhwb3J0Q29udGFpbmVyKTogSVNldHRpbmdzIHtcclxuICAgICAgICBcclxuICAgICAgICBsZXQgc2V0dGluZzogSVNldHRpbmdzID0gbmV3IFNldHRpbmdzKHRoaXMuc2V0dGluZ3NUeXBlKTtcclxuXHJcbiAgICAgICAgaWYocGFja2FnZURhdGE/Lm1ldGE/LmRhdGFUeXBlID09IERhdGFUeXBlLk9CSkVDVCAmJiBwYWNrYWdlRGF0YT8ubWV0YT8uW0FkZGl0aW9uYWxNZXRhS2V5cy5PQkpFQ1RUWVBFXSA9PSB0aGlzLm9iamVjdFR5cGUpIHtcclxuXHJcbiAgICAgICAgICAgIHN3aXRjaChwYWNrYWdlRGF0YT8ubWV0YT8uW0FkZGl0aW9uYWxNZXRhS2V5cy5WRVJTSU9OXSl7IFxyXG4gICAgICAgICAgICAgICAgY2FzZSAxOlxyXG4gICAgICAgICAgICAgICAgICAgIHNldHRpbmcgPSB0aGlzLnBhY2thZ2VWMVRvU2V0dGluZyhwYWNrYWdlRGF0YSwgY29udGFpbmVyKTtcclxuICAgICAgICAgICAgICAgICAgICBicmVhaztcclxuICAgICAgICAgICAgICAgIGRlZmF1bHQ6XHJcbiAgICAgICAgICAgICAgICAgICAgdGhyb3cgTWNlQ29udmVyc2lvbkVycm9yLmNyZWF0ZUVycm9yQnlUeXBlKE1jZUNvbnZlcnNpb25FcnJvclR5cGUuVU5TVVBQT1JURURfVkVSU0lPTiwgdGhpcy5vYmplY3RUeXBlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIHRocm93IE1jZUNvbnZlcnNpb25FcnJvci5jcmVhdGVFcnJvckJ5VHlwZShNY2VDb252ZXJzaW9uRXJyb3JUeXBlLlVOU1VQUE9SVEVEX1RZUEUsIHRoaXMub2JqZWN0VHlwZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2V0dGluZztcclxuICAgIH0gICAgXHJcblxyXG4gICAgcHJpdmF0ZSBwYWNrYWdlVjFUb1NldHRpbmcocGFja2FnZURhdGE6IElQYWNrYWdlLCBjb250YWluZXI6IEV4cG9ydENvbnRhaW5lcik6IElTZXR0aW5ncyB7XHJcbiAgICAgICAgXHJcbiAgICAgICAgbGV0IHNldHRpbmcgPSBuZXcgU2V0dGluZ3ModGhpcy5zZXR0aW5nc1R5cGUpO1xyXG4gICAgICAgIFxyXG4gICAgICAgIGlmKHBhY2thZ2VEYXRhPy5kYXRhPy5bRGF0YUlkcy5Db250YWluZXJOYW1lXT8ubWV0YT8uZGF0YVR5cGUgPT09IERhdGFUeXBlLlNUUklORykge1xyXG4gICAgICAgICAgICBzZXR0aW5nLnNldFZhbHVlKFNldHRpbmdJZHMuQ29udGFpbmVyTmFtZSwgcGFja2FnZURhdGE/LmRhdGE/LltEYXRhSWRzLkNvbnRhaW5lck5hbWVdPy5kYXRhKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHBhY2thZ2VEYXRhPy5kYXRhPy5bRGF0YUlkcy5TZXJpZUdyb3VwU3RhcnRUcmlnZ2VyVGltZV0/Lm1ldGE/LmRhdGFUeXBlID09PSBEYXRhVHlwZS5OVU1CRVIpIHtcclxuICAgICAgICAgICAgc2V0dGluZy5zZXRWYWx1ZShTZXR0aW5nSWRzLlNlcmllR3JvdXBTdGFydFRyaWdnZXJUaW1lLCBwYWNrYWdlRGF0YT8uZGF0YT8uW0RhdGFJZHMuU2VyaWVHcm91cFN0YXJ0VHJpZ2dlclRpbWVdPy5kYXRhKTtcclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyAgTWNlQ29udmVyc2lvbkVycm9yLmNyZWF0ZUVycm9yQnlUeXBlKE1jZUNvbnZlcnNpb25FcnJvclR5cGUuTUlTU0lOR19EQVRBLCBEYXRhSWRzLlNlcmllR3JvdXBTdGFydFRyaWdnZXJUaW1lKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmKHBhY2thZ2VEYXRhPy5kYXRhPy5bRGF0YUlkcy5TZXJpZXNJZHNdPy5tZXRhPy5kYXRhVHlwZSA9PT0gRGF0YVR5cGUuQVJSQVkgJiYgcGFja2FnZURhdGE/LmRhdGE/LltEYXRhSWRzLlNlcmllc0lkc10/Lm1ldGE/LltBZGRpdGlvbmFsTWV0YUtleXMuQVJSQVlUWVBFXSA9PT0gQXJyYXlUeXBlLlNUUklORykge1xyXG4gICAgICAgICAgICBzZXR0aW5nLnNldFZhbHVlKFNldHRpbmdJZHMuU2VyaWVzSWRzLCBwYWNrYWdlRGF0YT8uZGF0YT8uW0RhdGFJZHMuU2VyaWVzSWRzXT8uZGF0YSk7XHJcbiAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgdGhyb3cgTWNlQ29udmVyc2lvbkVycm9yLmNyZWF0ZUVycm9yQnlUeXBlKE1jZUNvbnZlcnNpb25FcnJvclR5cGUuTUlTU0lOR19EQVRBLCBEYXRhSWRzLlNlcmllc0lkcyk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gc2V0dGluZztcclxuICAgIH1cclxuXHJcbiAgICBzZXR0aW5nVG9QYWNrYWdlKHNldHRpbmdzRGF0YTogSVNldHRpbmdzKTogUGFja2FnZUFycmF5V2l0aFRvcExldmVsSUQge1xyXG4gICAgICAgIFxyXG4gICAgICAgIGxldCBzZXR0aW5ncyA9IFNldHRpbmdzLmNyZWF0ZShzZXR0aW5nc0RhdGEpO1xyXG5cclxuICAgICAgICBsZXQgc2VyaWVHcm91cERhdGE6IHsgW2luZGV4OiBzdHJpbmddOiAgSVBhY2thZ2UgfSAgPSB7fTtcclxuXHJcbiAgICAgICAgbGV0IHBhY2thZ2VTdHJ1Y3R1cmU6IFBhY2thZ2VBcnJheVdpdGhUb3BMZXZlbElEID0ge1xyXG4gICAgICAgICAgICBwYWNrYWdlczogbmV3IEFycmF5PElQYWNrYWdlPigpLFxyXG4gICAgICAgICAgICB0b3BMZXZlbElEOiBOYU5cclxuICAgICAgICB9O1xyXG4gICAgICAgIGlmKHNldHRpbmdzLnR5cGUgPT09IHRoaXMuc2V0dGluZ3NUeXBlKSB7XHJcblxyXG4gICAgICAgICAgICBsZXQgaWQgPSBNZXRhLmNyZWF0ZUlEKCk7XHJcbiAgICAgICAgICAgIGxldCBhZGRpdGlvbmFsTWV0YUluZm8gPSBbe2tleTogQWRkaXRpb25hbE1ldGFLZXlzLk9CSkVDVFRZUEUsIHZhbHVlOiB0aGlzLm9iamVjdFR5cGV9LCB7a2V5OiBBZGRpdGlvbmFsTWV0YUtleXMuSUQsIHZhbHVlOiBpZH0sIHtrZXk6IEFkZGl0aW9uYWxNZXRhS2V5cy5WRVJTSU9OLCB2YWx1ZTogdGhpcy5jdXJyZW50UGFja2FnZVZlcnNpb259XTtcclxuICAgICAgICAgICAgbGV0IHNlcmllc0dyb3VwTWV0YSA9IG5ldyBNZXRhKERhdGFUeXBlLk9CSkVDVCwgYWRkaXRpb25hbE1ldGFJbmZvKTtcclxuICAgICAgICAgICAgXHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBsZXQgY29udGFpbmVyTmFtZURhdGEgPSBzZXR0aW5ncy5nZXRWYWx1ZShTZXR0aW5nSWRzLkNvbnRhaW5lck5hbWUpO1xyXG4gICAgICAgICAgICBpZihjb250YWluZXJOYW1lRGF0YSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBzZXJpZUdyb3VwRGF0YVtEYXRhSWRzLkNvbnRhaW5lck5hbWVdID0gbmV3IFBhY2thZ2UobmV3IE1ldGEoRGF0YVR5cGUuU1RSSU5HKSwgY29udGFpbmVyTmFtZURhdGEpO1xyXG4gICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICBsZXQgc2VyaWVHcm91cFN0YXJ0VHJpZ2dlclRpbWVEYXRhID0gc2V0dGluZ3MuZ2V0VmFsdWUoU2V0dGluZ0lkcy5TZXJpZUdyb3VwU3RhcnRUcmlnZ2VyVGltZSk7XHJcbiAgICAgICAgICAgIGlmKHNlcmllR3JvdXBTdGFydFRyaWdnZXJUaW1lRGF0YSAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgICAgICAgICBzZXJpZUdyb3VwRGF0YVtEYXRhSWRzLlNlcmllR3JvdXBTdGFydFRyaWdnZXJUaW1lXSA9IG5ldyBQYWNrYWdlKG5ldyBNZXRhKERhdGFUeXBlLk5VTUJFUiksIHNlcmllR3JvdXBTdGFydFRyaWdnZXJUaW1lRGF0YSk7XHJcbiAgICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBNY2VDb252ZXJzaW9uRXJyb3IuY3JlYXRlRXJyb3JCeVR5cGUoTWNlQ29udmVyc2lvbkVycm9yVHlwZS5NSVNTSU5HX0RBVEEsIFNldHRpbmdJZHMuU2VyaWVHcm91cFN0YXJ0VHJpZ2dlclRpbWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIFxyXG5cclxuICAgICAgICAgICAgbGV0IHNlcmllSWRzRGF0YSA9IHNldHRpbmdzLmdldFZhbHVlKFNldHRpbmdJZHMuU2VyaWVzSWRzKTtcclxuICAgICAgICAgICAgaWYoc2VyaWVJZHNEYXRhICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICAgICAgICAgIGxldCBzZXJpZUlkc01ldGEgPSBuZXcgTWV0YShEYXRhVHlwZS5BUlJBWSwgW3trZXk6IEFkZGl0aW9uYWxNZXRhS2V5cy5BUlJBWVRZUEUsIHZhbHVlOiBBcnJheVR5cGUuU1RSSU5HfV0pO1xyXG4gICAgICAgICAgICAgICAgc2VyaWVHcm91cERhdGFbRGF0YUlkcy5TZXJpZXNJZHNdID0gbmV3IFBhY2thZ2Uoc2VyaWVJZHNNZXRhLCBzZXJpZUlkc0RhdGEpO1xyXG4gICAgICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgTWNlQ29udmVyc2lvbkVycm9yLmNyZWF0ZUVycm9yQnlUeXBlKE1jZUNvbnZlcnNpb25FcnJvclR5cGUuTUlTU0lOR19EQVRBLCBTZXR0aW5nSWRzLlNlcmllc0lkcyk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgXHJcblxyXG4gICAgICAgICAgICBsZXQgc2VyaWVzR3JvdXBQYWNrYWdlID0gbmV3IFBhY2thZ2Uoc2VyaWVzR3JvdXBNZXRhLCBzZXJpZUdyb3VwRGF0YSk7XHJcbiAgICAgICAgICAgIFxyXG4gICAgICAgICAgICBwYWNrYWdlU3RydWN0dXJlLnBhY2thZ2VzLnB1c2goc2VyaWVzR3JvdXBQYWNrYWdlKTtcclxuICAgICAgICAgICAgcGFja2FnZVN0cnVjdHVyZS50b3BMZXZlbElEID0gaWQ7XHJcbiAgICAgICAgfWVsc2Uge1xyXG4gICAgICAgICAgICB0aHJvdyBNY2VDb252ZXJzaW9uRXJyb3IuY3JlYXRlRXJyb3JCeVR5cGUoTWNlQ29udmVyc2lvbkVycm9yVHlwZS5VTlNVUFBPUlRFRF9WRVJTSU9OLCB0aGlzLnNldHRpbmdzVHlwZSk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcGFja2FnZVN0cnVjdHVyZTtcclxuICAgIH1cclxufVxyXG5cclxuZXhwb3J0IHsgU2VyaWVHcm91cFBhY2thZ2VBZGFwdGVyIH0iXX0=